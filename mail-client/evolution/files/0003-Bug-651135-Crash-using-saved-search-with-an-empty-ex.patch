From af08ff1bebc895b4de15d1822d96c64d092f2bb5 Mon Sep 17 00:00:00 2001
From: Milan Crha <mcrha@redhat.com>
Date: Thu, 26 May 2011 13:48:22 +0200
Subject: [PATCH 3/3] Bug #651135 - Crash using saved search with an empty
 expression

---
 addressbook/gui/widgets/e-addressbook-model.c |    6 ++++++
 1 files changed, 6 insertions(+), 0 deletions(-)

diff --git a/addressbook/gui/widgets/e-addressbook-model.c b/addressbook/gui/widgets/e-addressbook-model.c
index 8e62e40..17eb2d3 100644
--- a/addressbook/gui/widgets/e-addressbook-model.c
+++ b/addressbook/gui/widgets/e-addressbook-model.c
@@ -904,6 +904,9 @@ e_addressbook_model_get_query (EAddressbookModel *model)
 {
 	g_return_val_if_fail (E_IS_ADDRESSBOOK_MODEL (model), NULL);
 
+	if (!model->priv->query)
+		return NULL;
+
 	return e_book_query_to_string (model->priv->query);
 }
 
@@ -920,6 +923,9 @@ e_addressbook_model_set_query (EAddressbookModel *model,
 	else
 		book_query = e_book_query_from_string (query);
 
+	if (!book_query)
+		return;
+
 	if (model->priv->query != NULL) {
 		gchar *old_query, *new_query;
 
-- 
1.7.5.rc3

